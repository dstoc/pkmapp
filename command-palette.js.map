{"version":3,"file":"command-palette.js","sourceRoot":"","sources":["../src/command-palette.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {css, customElement, html, LitElement, query, state, property} from './deps/lit.js';\n\nexport interface Argument {\n  readonly description: string;\n  // TODO: Replace with commands+freeform command.\n  suggestions(): Promise<string[]>;\n  validate(argument: string): boolean;\n}\n\nexport interface Command {\n  readonly description: string;\n  readonly argument?: Argument;\n  execute(argument?: string): Promise<void>;\n}\n\n@customElement('pkm-command-palette')\nexport class CommandPalette extends LitElement {\n  @property({attribute: true}) noHeader = false;\n  @state() activeIndex = 0;\n  @query('input') input!: HTMLInputElement;\n  static override get styles() {\n    return css`\n      input, .item {\n        border: none;\n        color: var(--root-color);\n        outline: none;\n        background: transparent;\n        font-size: 14pt;\n        padding-left: 10px;\n        font-family: var(--root-font);\n      }\n      input, #items {\n        margin: 10px;\n      }\n      #separator {\n        height: 1px;\n        background: var(--md-accent-color);\n        opacity: 0.25;\n      }\n      :host-context([no-header]) input {\n        display: none;\n      }\n      :host-context([no-header]) #separator {\n        display: none;\n      }\n      .item {\n        padding-top: 5px;\n        padding-bottom: 5px;\n      }\n      .item[data-active] {\n        background: rgba(128,128,128,0.3);\n        border-radius: 5px;\n      }\n      #items {\n        max-height: 50vh;\n        overflow: scroll;\n      }\n    `;\n  }\n  @state() pendingCommand?: Command;\n  @state() items: Command[] = [];\n  activeSearch?: string;\n  activeItems: Command[] = [];\n  override render() {\n    const search = this.input?.value ?? '';\n    if (search != this.activeSearch) {\n      this.activeSearch = search;\n      this.activeIndex = 0;\n    }\n    const pattern = new RegExp(\n        search.replace(\n            /(.)/g, (c) => c.replace(/[^a-zA-Z0-9]/, '\\\\$&') + '.*?'),\n        'i');\n    this.activeItems = this.items.filter((item) => {\n      return pattern.test(item.description);\n    });\n\n    this.activeIndex =\n        Math.max(0, Math.min(this.activeIndex, this.activeItems.length - 1));\n    return html`\n      <input\n          type=text\n          @keydown=${this.handleInputKeyDown}\n          @input=${() => this.requestUpdate()}\n          placeholder=${\n      this.pendingCommand?.description ?? 'Search commands...'}></input>\n      <div id=separator></div>\n      <div id=items>\n        ${\n      this.activeItems.map(\n          (item, idx) => html`\n        <div\n            class=item\n            ?data-active=${idx === this.activeIndex}\n            @click=${this.handleItemClick}\n            @pointermove=${() => this.activeIndex = idx}>${\n              item.description}</div>\n        `)}\n      </div>\n    `;\n  }\n  private handleInputKeyDown(e: KeyboardEvent) {\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        this.next();\n        return;\n      case 'ArrowUp':\n        e.preventDefault();\n        this.previous();\n        return;\n      case 'Enter':\n        e.preventDefault();\n        this.commit();\n        return;\n    }\n  }\n  private reset() {\n    this.pendingCommand = undefined;\n    this.input.value = '';\n    this.activeIndex = 0;\n    this.activeSearch = undefined;\n    this.activeItems = [];\n  }\n  private handleItemClick() {\n    this.commit();\n  }\n  setInput(input: string) {\n    this.input.value = input;\n    this.requestUpdate();\n  }\n  async commit() {\n    const selected = this.activeItems[this.activeIndex];\n    if (selected?.argument) {\n      // Made a selection, need to complete argument.\n      this.triggerArgument(selected);\n    } else if (this.pendingCommand) {\n      // Argument completion.\n      const argument = selected ? selected.description : this.activeSearch;\n      if (!this.pendingCommand.argument!.validate(argument ?? '')) return;\n      this.pendingCommand.execute(argument);\n      this.dispatchEvent(new CustomEvent('commit'))\n    } else if (selected) {\n      // Made a selection, no argument needed.\n      selected.execute();\n      this.dispatchEvent(new CustomEvent('commit'))\n    }\n  }\n  async triggerArgument(selected: Command) {\n    const argument = selected.argument!;\n    this.reset();\n    this.pendingCommand = selected;\n    this.items = [];\n    const items = (await argument.suggestions()).map((description) => ({\n                                                       description,\n                                                       async execute() {},\n                                                     }));\n    this.items = items;\n  }\n  trigger(commands: Command[], pending?: Command) {\n    this.reset();\n    this.pendingCommand = pending;\n    this.items = commands;\n    this.requestUpdate();\n  }\n  next() {\n    this.activeIndex++;\n  }\n  previous() {\n    this.activeIndex--;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'pkm-command-palette': CommandPalette;\n  }\n}\n"]}