{"version":3,"file":"metadata.js","sourceRoot":"","sources":["../src/metadata.ts"],"names":[],"mappings":"AAAA,4BAA4B;AAC5B,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,kDAAkD;AAClD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAKjC,OAAO,EAAC,wBAAwB,EAAC,MAAM,iBAAiB,CAAC;AAEzD,MAAM,OAAO,QAAQ;IAArB;QACU,SAAI,GAAG,IAAI,GAAG,EAAyB,CAAC;QACxC,YAAO,GAAG,IAAI,GAAG,EAAyC,CAAC;QAC3D,UAAK,GAAG,IAAI,GAAG,EAAkC,CAAC;IA6B5D,CAAC;IA5BC,uBAAuB;IACvB,GAAG,CAAC,IAA4B;QAC9B,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IACD,UAAU,CAAC,IAAY;QACrB,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAC9B,CAAC;IACD,cAAc,CAAC,IAAiC,EAAE,MAA4C;QAC5F,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;QACxC,MAAM,iBAAiB,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACjD,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,KAAK,MAAM,CAAC;QACxC,IAAI,iBAAiB,IAAI,CAAC,iBAAiB,KAAK,SAAS,IAAI,CAAC,UAAU,IAAI,MAAM,KAAK,cAAc,CAAC,EAAE;YACtG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAC1B,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;YAC9C,IAAI,IAAI,KAAK,SAAS,EAAE;gBACtB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;aACzB;YACD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;YACpC,iBAAiB,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;SAC9C;QACD,IAAI,UAAU,IAAI,MAAM,KAAK,cAAc,IAAI,wBAAwB,CAAC,SAAS,CAAC,EAAE;YAClF,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;YAC1B,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAClC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;YAC/B,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAChC,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;SACtC;IACH,CAAC;CACF","sourcesContent":["// Copyright 2023 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport type {CodeBlockNode} from './markdown/node.js';\nimport type {ViewModelNode} from './markdown/view-model.js';\nimport type {LogicalContainingBlock} from './block-util.js';\nimport {isLogicalContainingBlock} from './block-util.js';\n\nexport class Metadata {\n  private data = new Map<ViewModelNode, string>();\n  private reverse = new Map<ViewModelNode, LogicalContainingBlock>();\n  private names = new Map<string, LogicalContainingBlock>();\n  // TODO: sections, tags\n  get(node: LogicalContainingBlock) {\n    return this.data.get(node);\n  }\n  findByName(name: string) {\n    return this.names.get(name);\n  }\n  postEditUpdate(node: ViewModelNode&CodeBlockNode, change: 'connected'|'disconnected'|'changed') {\n    const container = node.viewModel.parent;\n    const previousContainer = this.reverse.get(node);\n    const isMetadata = node.info === 'meta';\n    if (previousContainer && (previousContainer !== container || !isMetadata || change === 'disconnected')) {\n      this.reverse.delete(node);\n      const name = this.data.get(previousContainer);\n      if (name !== undefined) {\n        this.names.delete(name);\n      }\n      this.data.delete(previousContainer);\n      previousContainer.viewModel.observe.notify();\n    }\n    if (isMetadata && change !== 'disconnected' && isLogicalContainingBlock(container)) {\n      const name = node.content;\n      this.reverse.set(node, container);\n      this.data.set(container, name);\n      this.names.set(name, container);\n      container.viewModel.observe.notify();\n    }\n  }\n}\n"]}