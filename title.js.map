{"version":3,"file":"title.js","sourceRoot":"","sources":["../src/title.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {Library} from './library.js';\nimport {assert} from './asserts.js';\nimport {findNextEditable} from './markdown/view-model-util.js';\nimport {\n  state,\n  property,\n  css,\n  customElement,\n  html,\n  LitElement,\n} from './deps/lit.js';\nimport {contextProvided} from './deps/lit-labs-context.js';\nimport {libraryContext} from './app-context.js';\nimport {getLogicalContainingBlock} from './block-util.js';\nimport {Observers, Observer} from './observe.js';\nimport type {ViewModelNode} from './markdown/view-model.js';\n\n@customElement('pkm-title')\nexport class Title extends LitElement {\n  static override get styles() {\n    return css`\n      .item {\n        text-decoration: underline;\n        cursor: pointer;\n      }\n    `;\n  }\n  @property()\n  node?: ViewModelNode;\n  @contextProvided({context: libraryContext, subscribe: true})\n  @state()\n  library!: Library;\n  observers?: Observers;\n\n  override render() {\n    if (!this.node) return ``;\n    this.observers?.clear();\n    let containers = [];\n    let next: ViewModelNode | undefined = this.node;\n    while (next) {\n      containers.unshift(next);\n      next = getLogicalContainingBlock(next);\n    }\n    this.observers = new Observers(\n      ...containers.map(\n        (container) =>\n          new Observer(\n            () => container.viewModel.observe,\n            (target, observer) => target.add(observer),\n            (target, observer) => target.remove(observer),\n            () => this.requestUpdate()\n          )\n      )\n    );\n    this.observers.update();\n\n    return html`\n      ${containers.map(\n        (node) =>\n          html`Â»\n            <a class=\"item\" @click=${() => this.onItemClick(node)}\n              >${getTitle(node, this.library)}</a\n            > `\n      )}\n    `;\n  }\n  private onItemClick(node: ViewModelNode) {\n    this.dispatchEvent(\n      new CustomEvent('title-item-click', {\n        detail: node,\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'pkm-title': Title;\n  }\n  interface HTMLElementEventMap {\n    'title-item-click': CustomEvent<ViewModelNode>;\n  }\n}\nfunction getTitle(node: ViewModelNode, library: Library): string {\n  switch (node.type) {\n    case 'list-item':\n      const inline = findNextEditable(node, node, false);\n      // TODO: convert nodes to text\n      return inline?.content.substring(0, 10) ?? 'no-inline';\n    case 'section':\n      // TODO: use metadata\n      return node.content;\n    case 'document':\n      const document = library.getDocumentByTree(node.viewModel.tree);\n      return document?.name ?? 'no-document';\n    default:\n      assert(false);\n  }\n}\n"]}