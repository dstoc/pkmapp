{"version":3,"file":"title.js","sourceRoot":"","sources":["../src/title.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {ViewModelNode} from './markdown/view-model.js';\nimport {Library} from './library.js';\nimport {assert} from './asserts.js';\nimport {findNextEditable} from './markdown/view-model-util.js';\nimport {state, property, css, customElement, html, LitElement} from './deps/lit.js';\nimport {contextProvided} from './deps/lit-labs-context.js';\nimport {libraryContext} from './app-context.js';\n\ntype LogicalContainingBlock = ViewModelNode&{type: 'list-item'|'section'|'document'};\n\n@customElement('pkm-title')\nexport class Title extends LitElement {\n  static override get styles() {\n    return css`\n      .item {\n        text-decoration: underline;\n        cursor: pointer;\n      }\n    `;\n  }\n  @property()\n  node?: LogicalContainingBlock;\n  @contextProvided({context: libraryContext, subscribe: true})\n  @state()\n  library!: Library;\n\n  override render() {\n    if (!this.node) return ``;\n    let containers = [];\n    let next: LogicalContainingBlock|undefined = this.node;\n    while (next) {\n      containers.unshift(next);\n      next = getLogicalContainingBlock(next);\n    }\n\n    return html`\n      ${containers.map(node => html`Â» <a class=item @click=${() => this.onItemClick(node)}>${getTitle(node, this.library)}</a> `)}\n    `;\n  }\n  private onItemClick(node: LogicalContainingBlock) {\n    this.dispatchEvent(new CustomEvent('title-item-click', {\n      detail: node,\n      bubbles: true,\n      composed: true,\n    }));\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'pkm-title': Title;\n  }\n  interface HTMLElementEventMap {\n    'title-item-click': CustomEvent<LogicalContainingBlock>;\n  }\n}\nfunction getTitle(node: LogicalContainingBlock, library: Library): string {\n  switch (node.type) {\n    case 'list-item':\n      const inline = findNextEditable(node, node, false);\n      // TODO: convert nodes to text\n      return inline?.content.substring(0, 10) ?? 'no-inline';\n    case 'section':\n      return node.content;\n    case 'document':\n      const document = library.getDocumentByTree(node.viewModel.tree);\n      return document?.aliases[0] ?? 'no-document';\n    default:\n      assert(false);\n  }\n}\n\n// TODO: dedupe with `logicalContainingBlock` in editor.ts\nfunction getLogicalContainingBlock(node: ViewModelNode): LogicalContainingBlock|undefined {\n  let next = node.viewModel.parent;\n  while (next) {\n    switch (next.type) {\n      case 'list-item':\n      case 'section':\n      case 'document':\n        return next;\n      default:\n        next = next.viewModel.parent;\n        continue;\n    }\n  }\n  return;\n}\n\n"]}